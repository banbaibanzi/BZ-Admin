import{_ as $,a as Z,f as z,b as G}from"./index-CYfdo8ub.js";/* empty css                *//* empty css                     *//* empty css               *//* empty css                  */import{r as C,L as B,c as H,l as P,m as N,P as s,S as l,p as g,W as J,u,A as K,$ as O,T as Q,V as M,ax as X,ay as Y,ap as j,aD as ee,aE as te}from"./vue-3R-0LehK.js";/* empty css                 */import{t as oe,E as b,u as ae,v as se,n as le,w as ne,x as re,y as ie}from"./element-BKD3LWCk.js";const ue=["width","height"],ce={__name:"Captcha",props:{width:{type:Number,default:100},height:{type:Number,default:40}},emits:["update:value"],setup(f,{expose:I,emit:V}){const r=f,x=C(null),m=B({str:"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890",imgCode:""}),_=V;H(()=>{x.value&&(m.imgCode=w())});const R=()=>{m.imgCode=w()},n=(e,o)=>Math.floor(Math.random()*(o-e)+e),v=(e,o)=>{const i=n(e,o),h=n(e,o),E=n(e,o);return`rgb(${i},${h},${E})`},w=()=>{const e=x.value.getContext("2d");e.fillStyle=v(200,230),e.fillRect(0,0,r.width,r.height);let o="";for(let i=0;i<4;i++){const h=m.str[n(0,m.str.length)];o+=h;const E=n(24,30),L=n(-30,30);e.font=`${E}px Simhei`,e.textBaseline="top",e.fillStyle=v(80,150),e.save(),e.translate(26*i+10,15),e.rotate(L*Math.PI/180),e.fillText(h,-5,-10),e.restore()}for(let i=0;i<5;i++)e.beginPath(),e.moveTo(n(0,r.width),n(0,r.height)),e.lineTo(n(0,r.width),n(0,r.height)),e.strokeStyle=v(180,230),e.closePath(),e.stroke();for(let i=0;i<40;i++)e.beginPath(),e.arc(n(0,r.width),n(0,r.height),1,0,2*Math.PI),e.closePath(),e.fillStyle=v(150,200),e.fill();return _("update:value",o),o};return I({handleDraw:R}),(e,o)=>(P(),N("canvas",{ref_key:"verifyRef",ref:x,width:f.width,height:f.height,onClick:R},null,8,ue))}},de=$(ce,[["__scopeId","data-v-93babce9"]]),pe=f=>(ee("data-v-9503a2b3"),f=f(),te(),f),fe={class:"login-page wh-full flex"},me={class:"f-c-c"},_e={class:"login-form"},he=pe(()=>g("div",null,"体验账号",-1)),ge={__name:"Login",setup(f){const I=Z(),V=X(),r=Y(),x="BZ Admin",m=C(),_=C(),R=(c,t,a)=>{t===""?a(new Error("请输入用户名")):a()},n=(c,t,a)=>{t===""?a(new Error("请输入密码")):a()},v=(c,t,a)=>{t===""?a(new Error("请输入验证码")):t.toLowerCase()!==_.value.toLowerCase()?a(new Error("验证码错误")):a()},w=C(null),e=C(!1),o=C({username:"",password:"",captcha:"",isRemember:!1}),i=B({username:[{validator:R,trigger:"blur"}],password:[{validator:n,trigger:"blur"}],captcha:[{validator:v,trigger:"blur"}]});function h(c){o.value.username=c,o.value.password=1234,L(!0)}function E(c,t){if(c)return!0;w.value.validate();const{username:a,password:y,captcha:d}=t;return!a||!y?(b.warning("请输入用户名和密码"),!1):d?d.toLowerCase()!==_.value.toLowerCase()?(m.value.handleDraw(),b.warning("验证码错误"),!1):!0:(b.warning("请输入验证码"),!1)}async function L(c){const{username:t,password:a}=o.value;if(!await E(c,o.value))return;e.value=!0;const d=b({message:"正在验证，请稍后...",type:"info",duration:0}),k={username:t,password:a};I.loginAction(k).then(S=>{q(S),e.value=!1,d.close()}).catch(()=>{e.value=!1,d.close(),m.value.handleDraw()})}async function q(c={}){const t=b({message:"登录中...",type:"info",duration:0});try{if(await z(),t.close(),b.success("登录成功"),A(),r.query.redirect){const a=r.query.redirect;delete r.query.redirect,V.push({path:a,query:r.query})}else V.push("/")}catch(a){t.close(),console.error(a)}}const A=()=>{w.value.resetFields()};return(c,t)=>{const a=G,y=ae,d=se,k=de,S=le,D=ne,T=re,U=ie,F=oe,W=j("debounce");return P(),N("div",fe,[s(F,{class:"login-wrap"},{default:l(()=>[g("div",me,[g("div",_e,[g("h2",null,J(u(x)),1),s(U,{class:"mt-32",ref_key:"loginRef",ref:w,model:u(o),rules:u(i)},{default:l(()=>[s(d,{prop:"username"},{default:l(()=>[s(y,{modelValue:u(o).username,"onUpdate:modelValue":t[0]||(t[0]=p=>u(o).username=p),placeholder:"请输入用户名",clearable:""},{prefix:l(()=>[g("i",null,[s(a,{name:"login-user"})])]),_:1},8,["modelValue"])]),_:1}),s(d,{prop:"password"},{default:l(()=>[s(y,{modelValue:u(o).password,"onUpdate:modelValue":t[1]||(t[1]=p=>u(o).password=p),placeholder:"请输入密码",type:"password","show-password":"",clearable:""},{prefix:l(()=>[g("i",null,[s(a,{name:"login-lock"})])]),_:1},8,["modelValue"])]),_:1}),s(d,{prop:"captcha"},{default:l(()=>[s(y,{class:"captcha-input",modelValue:u(o).captcha,"onUpdate:modelValue":t[3]||(t[3]=p=>u(o).captcha=p),modelModifiers:{trim:!0},minlength:4,maxlength:4,placeholder:"请输入验证码",clearable:""},{prefix:l(()=>[g("i",null,[s(a,{name:"login-key"})])]),append:l(()=>[s(k,{ref_key:"captchaRef",ref:m,value:u(_),"onUpdate:value":t[2]||(t[2]=p=>K(_)?_.value=p:null)},null,8,["value"])]),_:1},8,["modelValue"])]),_:1}),s(d,null,{default:l(()=>[O((P(),Q(S,{class:"w-full submit-btn",loading:u(e)},{default:l(()=>[M(" 登录 ")]),_:1},8,["loading"])),[[W,[()=>L()]]])]),_:1}),he,s(T,{gutter:20,class:"mt-10"},{default:l(()=>[s(D,{span:12},{default:l(()=>[s(S,{class:"plain-btn w-full",onClick:t[4]||(t[4]=p=>h("admin"))},{default:l(()=>[M(" admin账号 ")]),_:1})]),_:1}),s(D,{span:12},{default:l(()=>[s(S,{class:"plain-btn w-full",onClick:t[5]||(t[5]=p=>h("user"))},{default:l(()=>[M(" user账号 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])])])]),_:1})])}}},Ve=$(ge,[["__scopeId","data-v-9503a2b3"]]);export{Ve as default};
