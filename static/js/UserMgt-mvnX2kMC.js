import{_ as N}from"./CommonPage-Cqz-r_z4.js";import{_ as A,g as I}from"./index-CYfdo8ub.js";import{C as F}from"./el-select-CY5hw3qw.js";/* empty css               */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  */import{b as U,a as H}from"./Switch-Dwd9PxYy.js";/* empty css                 */import{O as R,E as Q,P as G,n as q,Q as J,w as W,x as X,L as K,R as Y}from"./element-BKD3LWCk.js";import{aF as V,aG as j,r as Z,l as g,T as m,u as a,L as D,w as ee,b as L,D as te,c as ae,n as ne,m as P,$ as le,S as p,X as x,Q as E,a8 as oe,P as b,p as B,F as ie,V as z,W as se}from"./vue-3R-0LehK.js";const re={__name:"Pagination",props:V({config:{type:Object,default:()=>({})}},{page:{},pageModifiers:{},pageSize:{},pageSizeModifiers:{},total:{},totalModifiers:{}}),emits:V(["update"],["update:page","update:pageSize","update:total"]),setup(i,{emit:n}){const t=j(i,"page"),u=j(i,"pageSize"),f=j(i,"total"),k=Z("total, sizes, prev, pager, next, jumper");return(w,l)=>{const s=R;return g(),m(s,{class:"pull-right pagination-area","current-page":t.value,"onUpdate:currentPage":l[0]||(l[0]=r=>t.value=r),"page-size":u.value,"onUpdate:pageSize":l[1]||(l[1]=r=>u.value=r),"page-sizes":i.config?.pageSizes,total:f.value,small:i.config?.small??!0,background:i.config?.background??!0,layout:i.config?.layout||a(k)},null,8,["current-page","page-size","page-sizes","total","small","background","layout"])}}},de=A(re,[["__scopeId","data-v-1593c795"]]),o=D({selection:!1,border:!0,stripe:!0,align:"center",height:"auto",set_height:!1,row_key:"id",expand_all:!1,loading_text:"加载中，请稍后",pagination:!0,pagination_config:{pageSizes:[10,30,50,100]},batch_delete:!1}),pe=(i,n={})=>{if(JSON.stringify(n)==="{}")return!1;const t=Object.keys(i);for(const u in n)Object.prototype.hasOwnProperty.call(n,u)&&t.includes(u)&&(i[u]=n[u])};function ce(){const{proxy:i}=L();let n=D({data:{},page_key:"page",pageSize_key:"pageSize",has:!0,api_url:"",api_module:"",api_key:"list",api_method:"post",delete_key:"id",search_params:{},format_data:null});const t=D({data:[],page:1,pageSize:10,total:0,loading:!1,data_id:""});ee([()=>t.page,()=>t.pageSize],l=>{const{page_key:s,pageSize_key:r}=n,_=Math.ceil(t.total/t.pageSize);let d={[s]:l[0]>_?_:l[0],[r]:l[1]};n.data={...n.data,...d},f()});const u=(l={},s="init")=>(s==="init"&&(n={...n,...l}),s==="search"&&(n.data[page_key]=1,t.page=1,n.search_params=l),f()),f=()=>{if(!n.has)return!1;const{api_url:l,api_module:s,api_key:r,api_method:_,data:d,search_params:c}=n;if(!l&&!s)return!1;const y=l||U?.[s]?.[r]?.url,T=U?.[s]?.[r]?.method||_;if(!y)return!1;const S={url:y,method:T,data:{...d,...c}};return t.loading=!0,new Promise((v,$)=>{F(S).then(M=>{const C=M.data;let e=C.data;n.format_data&&Object.prototype.toString.call(n.format_data)==="[object Function]"&&(e=n.format_data(e)),t.data=e,t.total=C.total,t.loading=!1,v()}).catch(()=>{t.loading=!1})})};return{tableData:t,initData:u,saveDataId:l=>{Array.isArray(l)?t.data_id=l.length?l.map(r=>r.id).join():"":t.data_id=l[n.delete_key]},handlerDeleteConfirm:()=>{i.$deleteConfirm({title:"删除",message:"确认删除当前数据吗？",thenFn:()=>new Promise((l,s)=>{setTimeout(()=>{Q.success("删除成功"),f(),t.data_id="",l()},1e3)})})}}}const ge=["innerHTML"],ue={__name:"index",props:{config:{type:Object,default:()=>({})},columns:{type:Array,default:()=>[]},request:{type:Object,default:()=>({})}},setup(i){const n=i,{tableData:t,initData:u,saveDataId:f,handlerDeleteConfirm:k}=ce(),{proxy:w}=L();te(()=>{pe(o,n.config),l(n.request)}),ae(()=>{o.set_height&&_()});const l=(d,c)=>{u(d,c)},s=d=>{f(d)},r=(d,c)=>{d==="delete"&&f(c),k()},_=()=>{ne(()=>{const d=w.$refs.tableRef;o.height=I(d.$el,92)})};return(d,c)=>{const y=G,T=H,S=q,v=J,$=W,M=X,C=K;return g(),P(E,null,[le((g(),m(v,{ref:"tableRef",style:{width:"100%"},data:a(t).data,stripe:a(o).stripe,height:a(o).height,border:a(o).border,"row-key":a(o).row_key,"default-expand-all":a(o).expand_all,"element-loading-text":a(o).loading_text||"加载中，请稍后",onSelectionChange:s},{default:p(()=>[a(o).selection?(g(),m(y,{key:0,type:"selection",width:"40"})):x("",!0),(g(!0),P(E,null,oe(i.columns,e=>(g(),P(E,{key:e.prop},[e.type==="switch"?(g(),m(y,{key:0,label:e.label,width:e.width,"min-width":e.min_width,align:a(o).align},{default:p(({row:h})=>[b(T,{modelValue:h[e.prop],"onUpdate:modelValue":O=>h[e.prop]=O,config:{...e.config,[e.config?.key_id]:h[[e.config?.key_id]]},disabled:h[e.disabled]},null,8,["modelValue","onUpdate:modelValue","config","disabled"])]),_:2},1032,["label","width","min-width","align"])):e.type==="function"?(g(),m(y,{key:1,label:e.label,width:e.width,align:a(o).align},{default:p(({row:h})=>[B("div",{innerHTML:e.callback&&e.callback(h)},null,8,ge)]),_:2},1032,["label","width","align"])):e.type==="slot"?(g(),m(y,{key:2,label:e.label,width:e.width,"min-width":e.min_width,align:a(o).align},{default:p(({row:h})=>[ie(d.$slots,e.slot_name,{data:h}),e.delete_btn?(g(),m(S,{key:0,size:"small",link:"",onClick:O=>r("delete",h)},{default:p(()=>[z(" 删除 ")]),_:2},1032,["onClick"])):x("",!0)]),_:2},1032,["label","width","min-width","align"])):(g(),m(y,{key:3,label:e.label,prop:e.prop,width:e.width,"min-width":e.min_width,align:a(o).align},null,8,["label","prop","width","min-width","align"]))],64))),128))]),_:3},8,["data","stripe","height","border","row-key","default-expand-all","element-loading-text"])),[[C,a(t).loading]]),a(o).pagination?(g(),m(M,{key:0,class:"mt-30"},{default:p(()=>[b($,{span:6},{default:p(()=>[a(o).batch_delete?(g(),m(S,{key:0,disabled:!a(t).data_id,onClick:c[0]||(c[0]=e=>r("batch"))},{default:p(()=>[z(" 批量删除 ")]),_:1},8,["disabled"])):x("",!0)]),_:1}),b($,{span:18},{default:p(()=>[b(a(de),{page:a(t).page,"onUpdate:page":c[1]||(c[1]=e=>a(t).page=e),"page-size":a(t).pageSize,"onUpdate:pageSize":c[2]||(c[2]=e=>a(t).pageSize=e),total:a(t).total,"onUpdate:total":c[3]||(c[3]=e=>a(t).total=e),config:a(o).pagination_config},null,8,["page","page-size","total","config"])]),_:1})]),_:1})):x("",!0)],64)}}},_e={class:"p-20"},De={__name:"UserMgt",setup(i){const n=D({config:{set_height:!0},table_columns:[{label:"用户名",prop:"username"},{label:"角色类型",prop:"roleType",type:"slot",slot_name:"roleType"},{label:"账号状态",prop:"accountStatus",type:"switch",config:{prop:"account_status",value_type:"api",api_module:"user",api_key:"status",key_id:"id"}},{label:"创建时间",prop:"createTime"},{label:"操作",type:"slot",slot_name:"operation",min_width:"140",delete_btn:!0}],request:{data:{pageNumber:1,pageSize:10},page_key:"pageNumber",pageSize_key:"pageSize",api_module:"user",delete_key:"id"}}),t=(f="")=>{},u=(f="")=>{};return(f,k)=>{const w=Y,l=q,s=ue,r=N;return g(),m(r,null,{default:p(()=>[B("div",_e,[b(s,{config:a(n).config,columns:a(n).table_columns,request:a(n).request},{roleType:p(({data:_})=>[b(w,{effect:"plain",round:"",type:_.roleType==="管理员"?"primary":"warning"},{default:p(()=>[z(se(_.roleType),1)]),_:2},1032,["type"])]),operation:p(({data:_})=>[b(l,{type:"danger",size:"small",link:"",onClick:d=>t(_.id)},{default:p(()=>[z(" 编辑 ")]),_:2},1032,["onClick"]),b(l,{type:"danger",size:"small",link:"",onClick:d=>u(_.id)},{default:p(()=>[z(" 修改密码 ")]),_:2},1032,["onClick"])]),_:1},8,["config","columns","request"])])]),_:1})}}};export{De as default};
